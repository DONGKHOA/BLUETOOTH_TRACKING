/******************************************************************************
 *      INCLUDES
 *****************************************************************************/

#include "app_temp_humid.h"
#include "app_data.h"

#include "dht22.h"

/******************************************************************************
 *    PRIVATE DEFINES
 *****************************************************************************/

#define TAG "APP_TEMP_HUMID"

/******************************************************************************
 *    PRIVATE TYPEDEFS
 *****************************************************************************/

typedef struct
{
  dht22_data_t dht22;
} temp_humid_t;

/******************************************************************************
 *  PRIVATE PROTOTYPE FUNCTION
 *****************************************************************************/

static void APP_TEMP_HUMID_Task(void *arg);

/******************************************************************************
 *    PRIVATE DATA
 *****************************************************************************/

 static temp_humid_t s_temp_humid;

/******************************************************************************
 *      PUBLIC FUNCTION
 *****************************************************************************/

void APP_TEMP_HUMID_CreateTask(void)
{
  xTaskCreate(APP_TEMP_HUMID_Task, "APP_TEMP_HUMID_Task", 2048, NULL, 5, NULL);
}

void APP_TEMP_HUMID_Init(void)
{
  s_temp_humid.dht22.temperature = 0.0f;
  s_temp_humid.dht22.humidity    = 0.0f;
}

/******************************************************************************
 *  PRIVATE FUNCTION
 *****************************************************************************/

static void
APP_TEMP_HUMID_Task (void *arg)
{
  while (1)
  {
    DEV_DHT22_GetData(&s_temp_humid.dht22, DHT22_PIN);
    vTaskDelay(5000 / portTICK_PERIOD_MS);
  }
}